# Online facial recognition SDK

**Version: 3.0.1**

---


## 1. Introduction

### 1.1 Overview

* These API specifications have been defined to help developers create online facial recognition functions based on Rokid Glass.

### 1.2 Applicable scenarios

* Developers: The developers have their own face database in the cloud, and are capable of developing applications in the cloud.
* Purpose of development: To create online facial recognition products for Rokid Glass that meet individual requirements according to this Rokid Glass API protocol.

---


## 2. Integration procedure

1. Implement the recognition API for the cloud according to the API specifications.  
2. Edit the configuration file.
 - 2.1 Filename of the configuration file is `config.json`, which cannot be changed.
 - 2.2 Default content of the configuration file is:
    ```json
    {
    "recognizeOn" : false,
    "serverUrl" : "http://10.88.1.127:8848/faceRecognize"
    }
    ```
 - 2.3 Description of properties in the configuration file
Property| Description
----------|----------
recognizeOn| Set this to true to activate online recognition, and false to deactivate it.
serverUrl| Actual URL of the online recognition service can be set according to the API specifications below.
3. Import the modified configuration file
 
    Save the modified configuration file `config.json` in the directory `/sdcard/rokid/faceRecognize/` on the glasses. If a customized configuration file is not imported before the facial recognition app is run for the first time, a default configuration file will be generated in the above directory.Online recognition will be deactivated by default.

4. Run the facial recognition app
After completing all the above steps, restart the facial recognition app to use it to perform online recognition.

---


## 3. API specifications

### Requests from the device

1. Request URL: `http(s)://${ip}:${port}/${suffix}`
   
   - There are no restrictions on ip, port and suffix. The glasses will obtain them from the configuration file `config.json` and send a request to the cloud.

2. Request method: `POST`

3. A sample request:
   
    ```json
    {
     "imageInfo" : {
       "size" : 3686400,
       "width" : 1280,
       "height" : 720,
       "type" : "JPG",
       "imageFileStr" : "/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMVt+KZ3DEdqysreMn/9k=\n"
       },
     "deviceInfo" : "0611061920000161",
     "trackId" : 34,
    }
    ```

4. Description of request parameters:

Parameter Name| Parameter Type| Required?| Description
----------|----------|----------|----------
imageInfo| Object| Yes| Information on the uploaded facial image
deviceInfo| String| No| Device serial number
trackId| int| Yes| Facial tracking ID

    - Description of the imageInfo structure:

Parameter Name| Parameter Type| Required?| Description
----------|----------|----------|----------
size| int| No| Size of matted facial image
width| int| No| Width of matted facial image
height| int| No| Height of matted facial image
type| String| No| Always use JPG
imageFileStr| String| Yes| Binary data of the matted facial image file, <br/>a string generated by Base64 (NO\_WRAP) encoding

### Responses from the cloud

1. Sample responses in JSON format:
   
   - This is a response when everything is OK:
   
    ```json
    {
     "code" : 0,
     "message" : "Service invocation succeeded.",
     "faceInfo" : {
       "imageFileStr" : "/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMVt+KZ3DEdqysreMn/9k=\n",
       "name" : "Mike",
       "tag" : "Passed",
       "trackId" : 34
     }
     }
     ```
   
   - This is a response when an error occurs:
   
    ```json
    {
     "code" : 1,
     "message" : "No face detected",
     "faceInfo" : {
     }
     }
     ```

2. Description of returned parameters:

Parameter Name| Parameter Type| Required?| Description
----------|----------|----------|----------
code| int| Yes| Return code (0 means "correct"; see the list of error codes for meanings of other values)
message| String| Yes| Description of result of service invocation
faceInfo| Object| Yes| Face information, whose structure is described below

- Description of the faceInfo structure

Parameter Name| Parameter Type| Required?| Description
----------|----------|----------|----------
imageFileStr| String| Yes| Binary data of the facial image file (**must be in JPG or PNG format**) as part of the recognition result,<br/> a string generated by Base64 (NO\_WRAP) encoding
name| String| Yes| Corresponding name for the face
tag| String| No| Custom label
trackId| int| Yes| Face tracking ID included in the corresponding request

---


## 4. Notes

- Description of error codes:

Error Code| Description
----------|----------
0         | Service invocation succeeded.
1         | No face information matched (face not in the database).
2         | No face detected (e.g. extraction of facial features failed).
3         | Uploaded picture (e.g. its resolution and size) failed to meet requirements.
4         | Other error

